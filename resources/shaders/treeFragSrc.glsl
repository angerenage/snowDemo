#version 430 core
in vec3 fragPos,fragNormal;out vec4 fragColor;layout(std430,binding=0)buffer b1{vec3 l[][2];};uniform vec3 lightPos;vec3 t(vec3 f,float s){vec3 v=vec3(0);for(int i=0;i<21;i++){vec3 d=l[i][0],n=l[i][1];v+=max(dot(f,normalize(d-fragPos)),0.)*n*(1./(1.+.09*length(d-fragPos)))*(1.-s)*.4;}return v;}void main(){vec3 f=normalize(fragNormal+.5*(vec3(fract(sin(dot(floor(fragPos.xy*50.),vec2(12.9898,78.233)))*43758.5453),fract(sin(dot(floor(fragPos.yz*50.),vec2(93.9898,67.345)))*43758.5453),fract(sin(dot(floor(fragPos.zx*50.),vec2(56.789,43.321)))*43758.5453))-.5));f=t(f,max(dot(f,normalize(lightPos-fragPos)),0.));fragColor=vec4(f*.5,1);}