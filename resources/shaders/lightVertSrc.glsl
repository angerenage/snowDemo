#version 430 core
layout(location=0)in vec3 origin;layout(location=1)in vec3 direction;layout(location=2)in vec2 interval;layout(std430,binding=0)buffer b1{vec3 l[][2];};uniform mat4 projection,view;uniform vec2 resolution;uniform float time;void main(){uint n=11+gl_VertexID;float v=time-interval.x,a=interval.y;vec3 e=origin+direction*v+.5*vec3(0,-4.9,0)*v*v;if(time<interval.x||e.y<.35||v>a+.2){l[n][0]=vec3(0);l[n][1]=vec3(0);gl_Position=vec4(vec3(0),1);gl_PointSize=0.;return;}v=v<a?1.+12.*exp(6.*(clamp((v-a*.9)/(a*.1),0.,1.)-1.)):13.*exp(-4.*clamp((v-a)/.2,0.,1.));l[n][0]=e;l[n][1]=vec3(0,.2,.4)*v;vec4 i=projection*(view*vec4(e,1)),c=projection*(view*vec4(e+vec3(0,.5,0),1));gl_Position=i;gl_PointSize=length(c.xy/c.w-i.xy/i.w)*.5*resolution.y*mix(1.,2.5,clamp(v/13.,0.,1.));}