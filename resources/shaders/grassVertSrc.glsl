#version 330 core
layout(location=0)in vec3 position;layout(location=1)in vec4 instancePos;out vec3 fragPos;out vec2 fragUV;uniform mat4 projection,view,model;uniform vec2 offset;uniform float time;uniform sampler2D heightMap;const vec2 v=normalize(vec2(1));void main(){fragUV=vec2(position.x,position.y/.508);vec2 n=instancePos.xy+offset*2.;float p=sin(dot(n+v*time,vec2(1))+fract(sin(dot(n,vec2(12.9898,78.233)))*43758.5453)*3.14)*fragUV.y;vec3 s=position;s.xz+=p*.04;s=s*instancePos.w+instancePos.xyz+vec3(offset.x,0,offset.y)*20.;s.y+=texture(heightMap,(instancePos.xz/20.+offset)*.5+.5).x*10.;fragPos=s;gl_Position=projection*view*model*vec4(s,1);}