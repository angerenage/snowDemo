#version 430 core
layout(std430,binding=0)buffer b1{vec3 p[][2];};in vec3 fragPos,fragNormal;flat in uint fragMaterial;out vec4 fragColor;uniform vec3 lightPos;vec3 v(float f){vec3 v=vec3(0);for(int r=0;r<21;r++){vec3 l=p[r][0],n=p[r][1];v+=max(dot(fragNormal,normalize(l-fragPos)),0.)*n*(1./(1.+.09*length(l-fragPos)))*(1.-f);}return v;}void main(){if(fragMaterial==1){fragColor=vec4(1);return;}float f=max(dot(normalize(lightPos),vec3(0,1,0)),0.);vec3 l=v(f);fragColor=vec4(vec3(.05)+min(vec3(.3,.3,.4)*f,1.)*.05+l,1);}