#version 430 core
layout(location=0)in vec3 position;layout(location=3)in vec3 instanceOffset;out vec2 uv,texCoords;out vec3 posWorld;out flat int instanceIndex;uniform mat4 model;uniform float size;uniform vec2 characterPos;uniform float worldZOffset;void main(){instanceIndex=int(instanceOffset.y);uv=position.xz/size+.5;vec4 v=model*vec4(position,1);v.z+=worldZOffset;posWorld=v.xyz+vec3(instanceOffset.x,0,instanceOffset.z);texCoords=((posWorld.xz-characterPos)/size+1.)/2.;gl_Position=v;}